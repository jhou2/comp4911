var cascadiaControllers=angular.module("cascadiaControllers",["base64","restangular"]);cascadiaControllers.service("CascadiaService",["$rootScope","Restangular",function(e,t){e.user=JSON.parse(localStorage.getItem("user")),this.IsSupervisor=function(){t.all("user/peons").getList().then(function(e){var t=e;return t.length})},this.IsResponsibleEngineer=function(){var e="user/work_packages/?filter=responsibleEngineer";t.all(e).getList().then(function(e){var t=e;return t.length})},this.IsProjectManager=function(){var e="user/projects/managed";t.all(e).getList().then(function(e){var t=e;return t.length})}}]),cascadiaControllers.controller("EngineerController",["$scope",function(e){function t(t){t.selected===!0&&t.disabled!==!0&&(e.selectedEngineers.push({number:t.number,name:t.name,paygrade:t.paygrade,selected:!1}),t.disabled=!0,t.selected=!1)}function a(t){if(void 0!==t&&t.selected===!0){for(var a=t.number,r=0;r<e.engineers.length;r++)e.engineers[r].number==a&&(e.engineers[r].disabled=!1);var n=e.selectedEngineers.indexOf(t);return n>-1&&e.selectedEngineers.splice(n,1),!0}return!1}e.engineers=[{number:"A1111",name:"Javier Olson",paygrade:"P4",selected:!1,disabled:!1},{number:"A1112",name:"Nancy Garcia",paygrade:"P5",selected:!1,disabled:!1},{number:"A1113",name:"David Bowden",paygrade:"SS",selected:!1,disabled:!1}],e.selectedEngineers=[],e.selectE=function(t){e.engineers[t].disabled||(e.engineers[t].selected=e.engineers[t].selected?!1:!0)},e.addedSelectE=function(t){e.selectedEngineers[t].selected=e.selectedEngineers[t].selected?!1:!0},e.addE=function(){e.engineers.forEach(t)},e.removeE=function(){for(var t=e.selectedEngineers.length,r=0;t>r;)a(e.selectedEngineers[r])||r++}}]),cascadiaControllers.controller("AEPController",["$scope","CascadiaService","$location","Restangular",function(e,t,a,r){r.all("projects").getList().then(function(t){e.projects=t})}]),cascadiaControllers.controller("AEWPController",["$scope","CascadiaService","$location","Restangular","$routeParams",function(e,t,a,r,n){e.param=n.id,r.all("work_packages/"+e.param).getList().then(function(t){e.packages=t})}]),cascadiaControllers.controller("ManagerController",["$scope",function(e){function t(e){e.selected=!1}e.managers=[{id:"A1111",name:"Javier Olson",paygrade:"P4",selected:!1},{id:"A1112",name:"Nancy Garcia",paygrade:"P2",selected:!1},{id:"A1113",name:"David Bowden",paygrade:"P5",selected:!1},{id:"A1114",name:"Juan Burdine",paygrade:"SS",selected:!1}],e.selectedManager={},e.selectM=function(a){e.managers[a].id;e.managers.forEach(t),e.managers[a].selected=!0,e.selectedManager=e.managers[a]},e.cancel=function(){e.selectedManager={},e.managers.forEach(t)}}]),cascadiaControllers.controller("APController",["$scope","CascadiaService","$location","Restangular",function(e,t,a,r){r.one("users",3).get().then(function(t){e.manUser=t}),r.all("projects").getList().then(function(t){e.projects=t})}]),cascadiaControllers.controller("ARController",["$scope","CascadiaService","$location","Restangular","$routeParams",function(e,t,a,r,n){e.param=n.id,r.one("work_packages/"+e.param).get().then(function(t){e.package=t}),r.all("users").getList().then(function(t){e.engineers=t})}]),cascadiaControllers.controller("ASController",["$scope","$rootScope","CascadiaService","$location","Restangular",function(e,t,a,r,n){e.selectedEngineer,e.selectM=function(t){e.selectedEngineer=t},e.search=function(t){return-1!=t.id.toString().indexOf(e.query)||-1!=t.firstName.indexOf(e.query)||-1!=t.lastName.indexOf(e.query)?!0:!1},e.save=function(){var a=t.userMap[t.user.id];a.supervisorUserID=e.selectedEngineer.id,n.one("users",a.id).customPUT(a)}}]),cascadiaControllers.controller("PackageController",["$scope",function(e){function t(t){t.selected===!0&&t.disabled!==!0&&(e.selectedPackages.push({number:t.number,title:t.title,selected:!1}),t.disabled=!0,t.selected=!1)}function a(t){if(void 0!==t&&t.selected===!0){for(var a=t.number,r=0;r<e.packages.length;r++)e.packages[r].number==a&&(e.packages[r].disabled=!1);var n=e.selectedPackages.indexOf(t);return n>-1&&e.selectedPackages.splice(n,1),!0}return!1}e.packages=[{number:"B1111",title:"Project Setup",selected:!1,disabled:!1},{number:"B1112",title:"Ongoing Updating",selected:!1,disabled:!1},{number:"B1113",title:"Detailed Planning",selected:!1,disabled:!1}],e.selectedPackages=[],e.select=function(t){e.packages[t].disabled||(e.packages[t].selected=e.packages[t].selected?!1:!0)},e.addedSelect=function(t){e.selectedPackages[t].selected=e.selectedPackages[t].selected?!1:!0},e.add=function(){e.packages.forEach(t)},e.remove=function(){for(var t=e.selectedPackages.length,r=0;t>r;)a(e.selectedPackages[r])||r++}}]),cascadiaControllers.controller("CreateProjectsController",["$scope","CascadiaService","$location","Restangular",function(e){e.project}]),cascadiaControllers.controller("CreateWPController",["$scope","CascadiaService","$location","Restangular",function(e,t,a,r){r.all("projects").getList().then(function(t){e.projects=t}),e.listWP=function(t){r.all("work_packages/project/"+t).getList().then(function(t){e.packages=t})},e.addNew=function(){e.packages.push({workPackageNumber:"",issueDate:"",completeDate:"",startDate:"",description:"",progressStatus:"",endDate:"",estimateToCompletion:"",estimateAtStart:"",projectNumber:""})}}]),cascadiaControllers.controller("DashboardController",["$scope","$rootScope","Restangular","CascadiaService",function(e,t,a){a.one("user/timesheets").get().then(function(t){e.timesheets=t}),e.date=function(t){var a=e.timesheets[t],r=1+7*(a.weekNumber-1);return new Date(a.year,0,r)},e.delete=function(t,a){user.remove().then(function(){e.timesheets.splice(a,1)}),console.log("timesheet deleted")}}]),cascadiaControllers.controller("EditPayRatesController",["$scope","CascadiaService","$location","Restangular",function(e,t,a,r){var n=r.all("pay_rates");e.payRatesMap={},e.payRates=[],n.getList().then(function(t){e.payRates=t;for(var a=0;a<e.payRates.length;++a)e.payRatesMap[e.payRates[a].year]=[];for(var a=0;a<e.payRates.length;++a)e.payRatesMap[e.payRates[a].year].push(e.payRates[a])}),e.index=2014,payRatesChanged=[],e.change=function(e){unique=!0;for(var t=0;t<payRatesChanged.length;t++)if(payRatesChanged[t].id==e.id){unique=!1;break}unique&&payRatesChanged.push(e)},e.edit=function(){for(var e=0;e<payRatesChanged.length;e++)payRatesChanged[e].put()},e.prior=function(){e.payRatesMap[e.index-2]&&e.index--},e.next=function(){e.payRatesMap[e.index+2]&&e.index++},e.current=function(){e.index=2014}}]),cascadiaControllers.controller("EngineerBudgetController",["$scope","CascadiaService","$location","Restangular",function(){}]),cascadiaControllers.controller("NavigationController",["$scope","$rootScope","CascadiaService","$location","Restangular",function(e,t,a,r,n){n.all("user");e.IsEngineer=a.IsResponsibleEngineer(),e.IsProjectManager=a.IsProjectManager(),e.IsSupervisor=a.IsSupervisor(),e.logout=function(){localStorage.clear(),r.path("/login"),$.growl.notice({title:"Success!",message:"You have been logged out."})},e.IsAdmin=function(){return e.IsHr()||e.IsSupervisor||e.IsProjectManager},e.IsHr=function(){return t.user.isHR},e.IsTimesheetApprover=function(){for(var e in t.userMap)if(t.user.id==t.userMap[e].timesheetApproverUserID)return!0;return!1}}]),cascadiaControllers.controller("LoginController",["$scope","$base64","Restangular","$rootScope","$location","CascadiaService",function(e,t,a,r,n){e.login=function(){var o={username:e.username,password:e.password};a.one("user").post("token",o).then(function(o){e.encodedString=t.encode(o.token+":"),localStorage.setItem("token",e.encodedString),a.setDefaultHeaders({Authorization:"Basic "+e.encodedString}),a.one("user").get().then(function(e){localStorage.setItem("user",JSON.stringify(e)),r.user=e,n.path("/dashboard")})},function(e){400==e.status?$.growl.error({title:"Error!",message:"Missing username or password."}):401==e.status?$.growl.error({title:"Error!",message:"Authentication failed, please check your credentials again."}):$.growl.error({title:"Error!",message:"Status Code "+e.status})})}}]),cascadiaControllers.controller("LogoutController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("ManageApproverController",["$scope","CascadiaService","$location","Restangular",function(){}]),cascadiaControllers.controller("ManageProjectController",["$scope","CascadiaService","$location","Restangular",function(){}]),cascadiaControllers.controller("WPManagementController",["$scope","CascadiaService","Restangular",function(e,t,a){e.statuses=["Open","Closed"],e.project={},mapOfWP={},wpChanged=[],e.listWP=function(t){a.one("work_packages/project").getList(t.projectNumber).then(function(t){e.workPackages=t})},a.one("user/projects/managed").getList().then(function(t){e.projects=t}),e.change=function(e){unique=!0;for(var t=0;t<wpChanged.length;t++)if(wpChanged[t].workPackageNumber==e.workPackageNumber){unique=!1;break}unique&&wpChanged.push(e)},e.edit=function(){for(var e=0;e<wpChanged.length;e++)el=wpChanged[e],a.one("work_packages",el.workPackageNumber).customPUT(el);wpChanged=[]}}]),cascadiaControllers.controller("MonthlyWPController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCBACController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCPRController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("ProjectManagementController",["$scope","CascadiaService","Restangular",function(e,t,a){var r=a.all("projects");a.one("user/projects/managed").getList().then(function(t){e.projects=t}),e.add=function(){e.add_project=!0},e.save=function(){newproject=e.newproject,r.post(newproject).then(function(){e.projects.push(newproject),e.add_project=!1})}}]),cascadiaControllers.controller("ProjectSummaryController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("RateSheetController",["$scope","Restangular",function(e,t){t.all("users").getList().then(function(t){e.users=t})}]),cascadiaControllers.controller("SearchProjectController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("TADetailsController",["$scope","$location","Restangular","$routeParams",function(e,t,a,r){e.param=r.id,a.one("timesheets",e.param).get().then(function(t){e.timesheet=t})}]),cascadiaControllers.controller("TAController",["$scope","$location","Restangular",function(e,t,a){e.timesheets=[],a.all("user/timesheets/to_approve").getList().then(function(t){e.timesheets=t}),e.select=function(a){var r=a,n="/timesheet/",o=n.concat(e.timesheets[r].id);t.path(o)}}]),cascadiaControllers.controller("TimesheetController",["$scope","$rootScope","CascadiaService","$location","Restangular","$routeParams",function(e,t,a,r,n){var o=n.one("user/timesheets");e.workPackageNumbers={},e.projectNumbers=[],n.one("user/projects/managed").getList().then(function(t){projects=t;for(var a=0;a<projects.length;++a)e.projectNumbers.push(projects[a].projectNumber)}),e.listWP=function(t){n.one("work_packages/project",t).getList().then(function(a){workPackages=a,e.workPackageNumbers[t]=[];for(var r=0;r<workPackages.length;++r)e.workPackageNumbers[t].push(workPackages[r].workPackageNumber)})},e.prior=function(){year=e.timesheet.year,week=e.timesheet.weekNumber-1,o.get({year:year,week:week}).then(function(t){e.timesheet=t})},e.next=function(){year=e.timesheet.year,week=e.timesheet.weekNumber+1,o.get({year:year,week:week}).then(function(t){e.timesheet=t})},o.get({filter:"current"}).then(function(t){currentTimesheet=t,e.timesheet=currentTimesheet}),e.save=function(){e.default&&t.user.defaultTimesheetID!=e.timesheet.id&&(t.user.defaultTimesheetID=e.timesheet.id,t.user.put()),e.timesheet.put()},e.delete=function(t){e.timesheet.timesheetRows.splice(t,1)},e.add=function(){e.timesheet.timesheetRows.push({workPackageNumber:"",projectNumber:"",saturday:0,sunday:0,monday:0,tuesday:0,wednesday:0,thursday:0,friday:0,total:0,note:""})}}]),cascadiaControllers.controller("UserProfileController",["$scope","$rootScope","CascadiaService","$routeParams","Restangular",function(e,t,a,r){e.param=r.id,e.mUser=t.userMap[e.param]}]),cascadiaControllers.controller("WeeklyProjectController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("WPDetailsController",["$scope","Restangular","$routeParams",function(e,t,a){e.param=a.id;var r=t.one("work_packages/"+e.param);r.get().then(function(t){e.package=t}),t.all("work_packages/"+e.param+"/assignments").getList().then(function(t){e.assignments=t})}]),cascadiaControllers.controller("WPStatusReportController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("UsersManagementController",["$scope","$rootScope","Restangular","CascadiaService",function(e,t,a,r){var n=a.all("users");e.items=["P1","P2","P3","P4","P5"],e.statuses=["Active","Inactive"],usersChanged=[],n.getList().then(function(t){e.users=t,r.initMapOfUsers(e.users)}),e.change=function(e){unique=!0;for(var t=0;t<usersChanged.length;t++)if(usersChanged[t].id==e.id){unique=!1;break}unique&&usersChanged.push(e)},e.delete=function(t,a){t.remove().then(function(){e.users.splice(a,1)}),console.log("user deleted")},e.edit=function(){for(var e=0;e<usersChanged.length;e++)usersChanged[e].put();usersChanged=[]},e.add=function(){e.add_user=!0},e.save=function(){newuser=e.newuser,n.post(newuser).then(function(){e.add_user=!1})}}]);