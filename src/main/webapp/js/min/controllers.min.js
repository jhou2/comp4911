function validateWPNumber(e){for(var t=e.length,r=1;t>r&&(0!=e.charAt(r-1)||0==e.charAt(r));r++);return t>r?!1:!0}var cascadiaControllers=angular.module("cascadiaControllers",["base64"]);cascadiaControllers.controller("EngineerController",["$scope","$modal","FilterUser","GrowlResponse","$routeParams","Restangular",function(e,t,r,o,n,s){e.param=n.id,e.package={},e.quantity=20,e.engineers=[],e.selectedEngineer={};var a=s.one("work_packages/"+e.param);a.get().then(function(t){e.package=t,c()});var c=function(){s.one("projects",e.package.projectNumber).get().then(function(t){e.project=t})};s.all("users").getList().then(function(t){e.engineers=t}),e.search=function(t){return r(t,e.query)},e.select=function(t){e.selectedEngineer=t},e.open=function(){var r=t.open({templateUrl:"myModalContent.html",controller:ModalInstanceCtrl,resolve:{item:function(){return e.selectedEngineer}}});r.result.then(function(){var t=s.one("work_packages",e.package.workPackageNumber);t.one("assignments",e.selectedEngineer.id).get().then(function(r){if(r.length)wpAssignment=r[0],wpAssignment.responsibleEngineer=!0,t.one("assignments",e.selectedEngineer.id).customPUT(wpAssignment).then(function(e){o(e)},function(e){o(e)});else{var n={workPackageNumber:e.package.workPackageNumber,userId:e.selectedEngineer.id,responsibleEngineer:!0};t.one("assignments").customPOST(n).then(function(e){o(e)},function(e){o(e)})}})},function(){console.log("dismissed")})}}]),cascadiaControllers.controller("ManagerController",["$scope","$rootScope","$modal","$location","FilterUser","GrowlResponse","$routeParams","Restangular",function(e,t,r,o,n,s,a,c){var i=a.id;e.project={},e.quantity=20,c.one("projects/"+i).get().then(function(t){e.project=t,u()}),c.all("users").getList().then(function(t){e.users=t});var u=function(){c.one("projects/"+e.project.projectNumber+"/assignments/manager").get().then(function(t){e.curProjectManager=t[0]})};e.hasProjectManager=function(){return angular.isDefined(e.curProjectManager)?e.curProjectManager.id:void 0},e.select=function(t){e.selectedManager=t},e.search=function(t){return n(t,e.query)},e.save=function(){var t={userId:e.selectedManager.id,projectNumber:e.project.projectNumber,projectManager:!0,active:!0};c.one("projects/"+e.project.projectNumber+"/assignments").customPOST(t).then(function(){o.path("manage-project"),toastr.success("Project Assigned")})},e.open=function(){var t=r.open({templateUrl:"myModalContent.html",controller:ModalInstanceCtrl,resolve:{item:function(){return e.selectedManager}}});t.result.then(function(){var t=c.one("projects",e.project.projectNumber);angular.isDefined(e.curProjectManager)&&t.one("assignments",e.curProjectManager.id).get().then(function(r){var o=r[0];o.projectManager=!1,t.one("assignments/"+e.curProjectManager.id).customPUT(o).then(function(e){s(e)},function(e){s(e)})}),t.one("assignments",e.selectedManager.id).get().then(function(r){if(r.length)projectAssignment=r[0],projectAssignment.projectManager=!0,t.one("assignments/"+e.selectedManager.id).customPUT(projectAssignment).then(function(){o.path("/projects")},function(e){s(e)});else{var n={projectNumber:e.project.projectNumber,userId:e.selectedManager.id,projectManager:!0,active:!0};t.one("assignments").customPOST(n).then(function(){o.path("/projects")},function(e){s(e)})}})},function(){console.log("dismissed")})}}]),cascadiaControllers.controller("AEPController",["$rootScope","$scope","$location","$routeParams","Restangular","GrowlResponse",function(e,t,r,o,n){var s=o.id,a=[],c=[];t.projects=[],t.quantity=20,n.one("users",s).get().then(function(e){t.cUser=e,i()});var i=function(){n.all("projects").getList().then(function(e){a=e;for(var t=0;t<a.length;t++)a[t].selected=!1;u()})},u=function(){n.all("users/"+t.cUser.id+"/projects").getList().then(function(e){c=e;for(var r=0;r<c.length;r++)for(var o=0;o<a.length;o++)c[r].projectNumber==a[o].projectNumber&&(a[o].selected=!0,a[o].markedForRemoval=!1);angular.copy(a,t.projects)})};t.markForAssignment=function(e){var r=t.projects[e]&&t.projects[e].markedForAssignment;t.projects[e].markedForAssignment=void 0==r||0==r?!0:!1},t.markForRemoval=function(e){var r=t.projects[e]&&t.projects[e].markedForRemoval;t.projects[e].markedForRemoval=void 0==r||0==r?!0:!1},t.add=function(){for(var e=t.projects.length,r=0;e>r;r++)if(t.projects[r].markedForAssignment){var o=t.projects[r].projectNumber;t.projects[r].selected=!0;var s=function(e){e.active=!0,n.one("projects/"+o+"/assignments/"+t.cUser.id).customPUT(e).then(function(){toastr.success("Employee Assigned")})},a=function(){var e={userId:t.cUser.id,projectNumber:o,active:!0};n.one("projects/"+o+"/assignments").customPOST(e).then(function(){toastr.success("Employee Assigned")})};n.all("projects/"+o+"/assignments/"+t.cUser.id).getList().then(function(e){e.length>0?(console.log("Greater than 0"),s(e[0])):(console.log("zero"),a())})}},t.remove=function(){for(var e=t.projects.length,r=0;e>r;r++)if(t.projects[r].markedForRemoval){var o=t.projects[r].projectNumber;n.all("projects/"+o+"/assignments/"+t.cUser.id).getList().then(function(e){console.log(e);var r=e[0];r.active=!1,n.one("projects/"+o+"/assignments/"+t.cUser.id).customPUT(r)}),t.projects[r].selected=!1,toastr.success("Employee Removed")}}}]),cascadiaControllers.controller("AEWPController",["$scope","$location","Restangular","$routeParams","GrowlResponse","FilterUser",function(e,t,r,o,n,s){var a=o.id;e.project={},e.package={},e.users=[],e.quantity=20;var c=[],i=[];r.one("work_packages",a).get().then(function(t){e.package=t,u(e.package)});var u=function(t){r.one("projects",t.projectNumber).get().then(function(t){e.project=t,l(e.project)})},l=function(e){r.all("projects/"+e.projectNumber+"/users").getList().then(function(e){c=e;for(var t=0;t<c.length;t++)c[t].selected=!1;p()})},p=function(){r.all("work_packages/"+a+"/assignments?filter=active").getList().then(function(t){i=t;for(var r=0;r<i.length;r++)for(var o=0;o<c.length;o++)i[r].id==c[o].id&&(c[o].selected=!0,c[o].markedForRemoval=!1);angular.copy(c,e.users)})};e.search=function(t){return s(t,e.query)},e.markForAssignment=function(t){var r=e.users[t]&&e.users[t].markedForAssignment;e.users[t].markedForAssignment=void 0==r||0==r?!0:!1},e.markForRemoval=function(t){var r=e.users[t]&&e.users[t].markedForRemoval;e.users[t].markedForRemoval=void 0==r||0==r?!0:!1},e.remove=function(){for(var t=e.users.length,o=0;t>o;o++)if(e.users[o].markedForRemoval){var n=e.users[o].id;r.all("work_packages/"+a+"/assignments/"+n).getList().then(function(e){var t=e[0];t.active=!1,r.one("work_packages/"+a+"/assignments/"+n).customPUT(t),toastr.success("Employee Removed")}),e.users[o].selected=!1}},e.add=function(){for(var t=e.users.length,o=0;t>o;o++)if(e.users[o].markedForAssignment){var n=e.users[o].id;e.users[o].selected=!0,e.users[o].markedForRemoval=!1;var s=function(e){e.active=!0,r.one("work_packages/"+a+"/assignments/"+n).customPUT(e).then(function(){toastr.success("Employee Assigned")})},c=function(){var e={userId:n,workPackageNumber:a,active:!0};r.one("work_packages/"+a+"/assignments").customPOST(e).then(function(){toastr.success("Employee Assigned")})};r.all("work_packages/"+a+"/assignments/"+n).getList().then(function(e){e.length>0?(console.log("Greater than 0"),s(e[0])):(console.log("zero"),c())})}}}]),cascadiaControllers.controller("ProjectManagementController",["$scope","$location","GrowlResponse","Restangular",function(e,t,r,o){function n(e){e.selected=!1}e.quantity=20,e.checked={};var s=function(){o.all("user/projects/managed").getList().then(function(t){e.projects=t})},a=function(){o.all("projects").getList().then(function(t){e.projects=t})},c=localStorage.getItem("permissions");-1!=c.indexOf("ProjectManager")?s():a();var i=function(e){o.one("projects/"+e.projectNumber+"/assignments/manager").get().then(function(e){return e.length})};e.hasProjectManager=function(t){return angular.isDefined(t)&&!e.checked[t.projectNumber]?(e.checked[t.projectNumber]=!0,i(t)):void 0},e.selectedManager={},e.selectM=function(t){e.managers[t].id;e.managers.forEach(n),e.managers[t].selected=!0,e.selectedManager=e.managers[t]},e.select=function(e){t.path("/projects/"+e.projectNumber)},e.cancel=function(){e.selectedManager={},e.managers.forEach(n)}}]),cascadiaControllers.controller("APController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){r.one("users",3).get().then(function(t){e.manUser=t}),r.all("projects").getList().then(function(t){e.projects=t})}]),cascadiaControllers.controller("ATAController",["$scope","$modal","$rootScope","$routeParams","$location","FilterUser","Restangular","GrowlResponse",function(e,t,r,o,n,s,a,c){var i=a.all("users"),u=o.id;e.cUser={},e.ta={},i.getList().then(function(t){e.users=t},function(e){c(e)}),a.one("users",u).get().then(function(t){e.cUser=t,e.cUser.timesheetApproverUserID&&loadTimsheetApprover()}),e.select=function(t){e.ta=t};e.hasTimesheetApprover=function(){var t=e.cUser;return t&&t.timesheetApproverUserID?!0:!1},e.search=function(t){return s(t,e.query)},e.open=function(){var o=t.open({templateUrl:"myModalContent.html",controller:ModalInstanceCtrl,resolve:{item:function(){return e.ta}}});o.result.then(function(){var t=e.cUser;t.timesheetApproverUserID=e.ta.id,s(t)},function(){console.log("dismissed")});var s=function(e){a.one("users",e.id).customPUT(e).then(function(t){r.user.id==t.id&&(localStorage.setItem("user",JSON.stringify(t)),r.user=t),n.path("users/"+e.id),toastr.success("Timesheet Approver Assigned")})}}}]),cascadiaControllers.controller("ASController",["$scope","$modal","$rootScope","$routeParams","$location","FilterUser","Restangular","GrowlResponse",function(e,t,r,o,n,s,a,c){var i=a.all("users"),u=o.id;e.cUser={},e.supervisor={},i.getList().then(function(t){e.users=t},function(e){c(e)}),a.one("users",u).get().then(function(t){e.cUser=t,e.cUser.supervisorUserID&&l()}),e.select=function(t){e.selectedEngineer=t};var l=function(){a.one("users",e.cUser.supervisorUserID).get().then(function(t){e.supervisor=t})};e.hasSupervisor=function(){var t=e.cUser;return t&&t.supervisorUserID?!0:!1},e.search=function(t){return s(t,e.query)},e.open=function(){var o=t.open({templateUrl:"myModalContent.html",controller:ModalInstanceCtrl,resolve:{item:function(){return e.selectedEngineer}}});o.result.then(function(){var t=e.cUser;t.supervisorUserID=e.selectedEngineer.id,t.timesheetApproverUserID||(t.timesheetApproverUserID=e.selectedEngineer.id),s(t)},function(){console.log("dismissed")});var s=function(e){a.one("users",e.id).customPUT(e).then(function(t){r.user.id==t.id&&(localStorage.setItem("user",JSON.stringify(t)),r.user=t),n.path("users/"+e.id),toastr.success("Supervisor Assigned")})}}}]);var ModalInstanceCtrl=function(e,t,r){e.item=r,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}};cascadiaControllers.controller("PackageController",["$scope","GrowlResponse",function(e){function t(t){t.selected===!0&&t.disabled!==!0&&(e.selectedPackages.push({number:t.number,title:t.title,selected:!1}),t.disabled=!0,t.selected=!1)}function r(t){if(void 0!==t&&t.selected===!0){for(var r=t.number,o=0;o<e.packages.length;o++)e.packages[o].number==r&&(e.packages[o].disabled=!1);var n=e.selectedPackages.indexOf(t);return n>-1&&e.selectedPackages.splice(n,1),!0}return!1}e.packages=[{number:"B1111",title:"Project Setup",selected:!1,disabled:!1},{number:"B1112",title:"Ongoing Updating",selected:!1,disabled:!1},{number:"B1113",title:"Detailed Planning",selected:!1,disabled:!1}],e.selectedPackages=[],e.select=function(t){e.packages[t].disabled||(e.packages[t].selected=e.packages[t].selected?!1:!0)},e.addedSelect=function(t){e.selectedPackages[t].selected=e.selectedPackages[t].selected?!1:!0},e.add=function(){e.packages.forEach(t)},e.remove=function(){for(var t=e.selectedPackages.length,o=0;t>o;)r(e.selectedPackages[o])||o++}}]),cascadiaControllers.controller("CreateProjectsController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r,o){var n=r.all("projects");e.rates=[1.2,1.6,2],e.save=function(){e.createProjectForm.$valid?n.post(e.project).then(function(){toastr.success("Project Created"),t.path("/projects")},function(e){o(e)}):toastr.warning("Invalid Input")}}]),cascadiaControllers.controller("CreateWPController",["$scope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o,n){e.param=o.id,e.workPackage={},e.project={},r.one("projects/"+e.param).get().then(function(t){e.project=t}),e.save=function(){e.createWPForm.$valid?validateWPNumber(e.workPackage.workPackageNumber)?(workPackage=e.workPackage,workPackage.progressStatus=!0,workPackage.issueDate=new Date,workPackage.projectNumber=e.project.projectNumber,r.one("work_packages").customPOST(e.workPackage).then(function(){t.path("manage-wp-pm"),toastr.success("Work Package Created")},function(e){n(e)})):toastr.warning("Invalid Input - Work Package Number: if a character is 0, then the characters following it must all be 0 too."):toastr.warning("Invalid Input")}}]),cascadiaControllers.controller("DashboardController",["$scope","$rootScope","Restangular","GrowlResponse",function(e,t,r){e.quantity=20,r.all("user/timesheets/rejected").getList().then(function(t){e.timesheets=t}),e.date=function(t){var r=e.timesheets[t],o=1+7*(r.weekNumber-1);return new Date(r.year,0,o)}}]),cascadiaControllers.controller("EditPayRatesController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){var o=r.all("pay_rates");e.payRatesMap={},e.payRates=[],o.getList().then(function(t){e.payRates=t;for(var r=0;r<e.payRates.length;++r)e.payRatesMap[e.payRates[r].year]=[];for(var r=0;r<e.payRates.length;++r)e.payRatesMap[e.payRates[r].year].push(e.payRates[r])}),e.index=2014,payRatesChanged=[],e.change=function(e){unique=!0;for(var t=0;t<payRatesChanged.length;t++)if(payRatesChanged[t].id==e.id){unique=!1;break}unique&&payRatesChanged.push(e)},e.edit=function(){for(var e=0;e<payRatesChanged.length;e++)payRatesChanged[e].put();toastr.success("Pay Rates Saved")},e.prior=function(){e.payRatesMap[e.index-2]&&e.index--},e.next=function(){e.payRatesMap[e.index+2]&&e.index++},e.current=function(){e.index=2014}}]),cascadiaControllers.controller("EngineerBudgetController",["$scope","$location","Restangular",function(){}]),cascadiaControllers.controller("NavigationController",["$scope","$rootScope","$location","Restangular","GrowlResponse",function(e,t){t.user=JSON.parse(localStorage.getItem("user"))}]),cascadiaControllers.controller("UnauthorizedController",["$scope",function(){}]),cascadiaControllers.controller("LoginController",["$scope","$base64","Restangular","$rootScope","$location","GrowlResponse","permissions",function(e,t,r,o,n,s,a){e.login=function(){if(e.loginForm.$valid){var c={username:e.username,password:e.password};r.one("user").post("token",c).then(function(c){e.encodedString=t.encode(c.token+":"),localStorage.setItem("token",e.encodedString),r.setDefaultHeaders({Authorization:"Basic "+e.encodedString}),r.one("user").get().then(function(e){localStorage.setItem("user",JSON.stringify(e)),o.user=e,r.one("user/permissions").get().then(function(e){a.setPermissions(e),localStorage.setItem("permissions",JSON.stringify(e))},function(e){s(e)}),o.isAuthenticated=!0,n.path("/dashboard")})},function(e){s(e)})}else toastr.warning("Invalid Input")}}]),cascadiaControllers.controller("LogoutController",["$scope","$location","$rootScope","Restangular",function(e,t,r){localStorage.clear(),r.isAuthenticated=!1,t.path("/login"),toastr.success("You Have Been Logged Out")}]),cascadiaControllers.controller("ManageApproverController",["$scope","$location","Restangular",function(){}]),cascadiaControllers.controller("ManageProjectController",["$scope","$location","Restangular",function(){}]),cascadiaControllers.controller("WPManagementPMController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){e.statuses=["Open","Closed"],e.projectChosen=!1,e.quantity=20;var o=function(){if(localStorage.getItem("project-wp-creation")){var t=JSON.parse(localStorage.getItem("project-wp-creation"));r.one("projects",t).get().then(function(t){e.project=t,localStorage.removeItem("project-wp-creation")})}};e.loadWorkPackages=function(){r.one("work_packages/project").getList(e.project.projectNumber).then(function(t){e.projectChosen=!0,e.workPackages=t})},e.loadProjects=function(){r.one("user/projects/managed").getList().then(function(t){e.projects=t,o()})},e.create=function(){localStorage.setItem("project-wp-creation",JSON.stringify(e.project.projectNumber)),t.path("/create-wp/"+e.project.projectNumber)}}]),cascadiaControllers.controller("WPManagementREController",["$scope","Restangular","GrowlResponse",function(e,t){e.statuses=["Open","Closed"],e.quantity=20,t.all("user/work_packages?filter=responsibleEngineer").getList().then(function(t){e.projectChosen=!0,e.workPackages=t})}]),cascadiaControllers.controller("MonthlyWPController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCBACController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCPRController",["$scope","Restangular","GrowlResponse",function(e,t){e.statuses=["Open","Closed"],e.project={},e.projectChosen=!1,e.quantity=20,e.loadProjects=function(){t.all("projects").getList().then(function(t){e.projects=t})},t.one("user/projects/managed").getList().then(function(t){e.projects=t})}]),cascadiaControllers.controller("ProjectManagementSupervisorController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){var o=r.all("projects");r.one("user/projects/managed").getList().then(function(t){e.projects=t}),e.select=function(e){t.path("/projects/"+e.projectNumber)},e.add=function(){e.add_project=!0},e.save=function(){newproject=e.newproject,o.post(newproject).then(function(){e.projects.push(newproject),e.add_project=!1,t.path("/projects"),toastr.success("Project Created")})}}]),cascadiaControllers.controller("ProjectDetailsController",["$scope","$routeParams","FilterUser","Restangular","calculateBudget",function(e,t,r,o,n){var s=t.id;e.project={},e.assignedUsers=[],e.quantity=20,e.pLevelBudget=[],o.one("projects",s).get().then(function(t){e.project=t,i(),c(),a()});var a=function(){o.one("reports/budget/"+e.project.projectNumber).get().then(function(t){e.report=t;var r=e.report.InitialEstimate,o=e.report.RemainingEstimate,s=e.report.CurrentSpending;e.dataArray=n(r,o,s)})},c=function(){o.one("projects/"+e.project.projectNumber+"/assignments/manager").get().then(function(t){e.projectManager=t[0]})},i=function(){o.all("projects/"+e.project.projectNumber+"/users").getList().then(function(t){e.assignedUsers=t})};e.hasProjectManager=function(){return angular.isDefined(e.projectManager)?e.projectManager.id:void 0},e.search=function(t){return r(t,e.query)}}]),cascadiaControllers.controller("ProjectSummaryController",["$scope","$routeParams","Restangular",function(e,t,r){var o=t.id;e.project={},r.all("reports/matrix/"+o).getList().then(function(t){e.project=t[0],n(),e.payRates=e.project.payRates,t.splice(0,1),e.rows=t,console.log(e.rows[0])});var n=function(){r.one("projects/"+e.project.projectNumber+"/assignments/manager").get().then(function(t){e.projectManager=t[0]})}}]),cascadiaControllers.controller("RateSheetController",["$scope","Restangular","GrowlResponse",function(e,t){t.all("users").getList().then(function(t){e.users=t})}]),cascadiaControllers.controller("SearchProjectController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("TADetailsController",["$scope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o){e.param=o.id,r.one("timesheets",e.param).get().then(function(t){e.timesheet=t}),e.approve=function(){e.timesheet.approved=!0,e.timesheet.pending=!1,e.timesheet.put().then(function(){t.path("/timesheet-approval")})},e.reject=function(){e.timesheet.pending=!1,e.timesheet.signed=!1,e.timesheet.put().then(function(){t.path("/timesheet-approval")})}}]),cascadiaControllers.controller("TAController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){e.timesheets=[],r.all("user/timesheets/to_approve").getList().then(function(t){e.timesheets=t}),e.select=function(e){var r="/timesheet-approval/",o=r.concat(e);t.path(o)}}]),cascadiaControllers.controller("TimesheetCorrectionController",["$scope","$rootScope","$routeParams","Restangular","GrowlResponse",function(e,t,r,o,n){var s=r.id;e.workPackageNumbers={},e.projectNumbers=[],t.user=JSON.parse(localStorage.getItem("user")),o.one("timesheets",s).get().then(function(t){e.timesheet=t,e.timesheet.signed=!1}),o.one("user/projects").getList().then(function(t){projects=t,a(projects);for(var r=0;r<projects.length;++r)e.projectNumbers.push(projects[r].projectNumber)},function(e){n(e)});var a=function(e){console.log("init list");for(var t=0;t<e.length;++t)listWP(e[t].projectNumber)};e.listWP=function(t){o.all("work_packages/project",t).getList().then(function(r){workPackages=r,e.workPackageNumbers[t]=[];for(var o=0;o<workPackages.length;++o)e.workPackageNumbers[t].push(workPackages[o].workPackageNumber)},function(e){n(e)}),e.save=function(){e.timesheet.put()},e.submit=function(){}}}]),cascadiaControllers.controller("TimesheetController",["$scope","$rootScope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o,n,s){var a=o.one("user/timesheets");e.workPackageNumbers={},e.projectNumbers=[],e.default=!1,a.get({filter:"current"}).then(function(t){e.timesheet=t,u()},function(e){s(e)});var c=function(t){o.one("work_packages/project",t).getList().then(function(r){workPackages=r,e.workPackageNumbers[t]=[];for(var o=0;o<workPackages.length;++o)e.workPackageNumbers[t].push(workPackages[o].workPackageNumber)},function(e){s(e)})},i=function(e){console.log("init list");for(var t=0;t<e.length;++t)c(e[t].projectNumber)};o.one("user/projects").getList().then(function(t){projects=t,i(projects);for(var r=0;r<projects.length;++r)e.projectNumbers.push(projects[r].projectNumber)},function(e){s(e)}),e.hasProjects=function(){return e.projectNumbers?e.projectNumbers.length>0:void 0},e.prior=function(){year=e.timesheet.year,week=e.timesheet.weekNumber-1,a.get({year:year,week:week}).then(function(t){e.timesheet=t},function(e){s(e)})},e.next=function(){year=e.timesheet.year,week=e.timesheet.weekNumber+1,a.get({year:year,week:week}).then(function(t){e.timesheet=t},function(e){s(e)})};e.$watch("user",function(){e.timesheet&&t.user&&(e.default=e.timesheet.id==t.user.defaultTimesheetID)},!0),e.$watch("timesheet",function(){e.timesheet&&t.user&&(e.default=e.timesheet.id==t.user.defaultTimesheetID)},!0),e.save=function(){e.makeDefault&&t.user.defaultTimesheetID!=e.timesheet.id&&o.one("users",t.user.id).get().then(function(r){var o=r;o.defaultTimesheetID=e.timesheet.id,o.put(),localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(o)),t.user=o}),u(),e.timesheet.put(),toastr.success("TimeSheet Saved")};var u=function(){for(var t=0,r=e.timesheet.timesheetRows,o=0;o<r.length;++o)t+=r[o].saturday+r[o].sunday+r[o].monday+r[o].tuesday+r[o].wednesday+r[o].thursday+r[o].friday;e.timesheet.overTime=t-400>0?t-400:0};e.submit=function(){e.timsheet.pending=!0},e.delete=function(t){e.timesheet.timesheetRows.splice(t,1)},e.add=function(){e.timesheet.timesheetRows.push({workPackageNumber:"",projectNumber:"",saturday:0,sunday:0,monday:0,tuesday:0,wednesday:0,thursday:0,friday:0,note:""})}}]),cascadiaControllers.controller("UserProfileController",["$scope","$modal","$location","GrowlResponse","$rootScope","$routeParams","Restangular",function(e,t,r,o,n,s,a){var c=JSON.parse(localStorage.getItem("user"));e.editFirstName=e.editLastName=e.editUserName=e.editPassword=!1,a.one("users",c.id).get().then(function(e){n.user=e});var i=function(){a.one("users",n.user.supervisorUserID).get().then(function(t){e.supervisor=t})},u=function(){a.one("users",n.user.timesheetApproverUserID).get().then(function(t){e.timesheetApprover=t})};n.user&&n.user.supervisorUserID&&(i(),u()),e.focusFirst=function(){e.editFirstName=!0},e.focusLast=function(){e.editLastName=!0},e.focusUserName=function(){e.editUserName=!0},e.focusPassword=function(){e.editPassword=!0},e.hasSupervisor=function(){var e=n.user;return e&&e.supervisorUserID?!0:!1},e.hasTimesheetApprover=function(){return c=n.user,c&&c.timesheetApproverUserID?!0:!1},e.save=function(){c=n.user,localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(c)),c.put().then(function(){r.path("dashboard")})}}]),cascadiaControllers.controller("ManagedUserProfileController",["$scope","$location","$rootScope","$routeParams","Restangular",function(e,t,r,o,n){var s=o.id;toastr.info("Double click to edit fields with the <i class='fa fa-pencil-square-o'></i> icon."),e.supervisor={},e.timesheetApprover={},e.editFirstName=e.editLastName=e.editUserName=e.editPLevel=e.editStatus=e.password=!1,e.items=["P1","P2","P3","P4","P5"],e.statuses=["Active","Inactive"],n.one("users",s).get().then(function(t){e.cUser=t,e.cUser.supervisorUserID&&(a(),c())});var a=function(){n.one("users",e.cUser.supervisorUserID).get().then(function(t){e.supervisor=t})},c=function(){n.one("users",e.cUser.timesheetApproverUserID).get().then(function(t){e.timesheetApprover=t})};e.focusFirst=function(){e.editFirstName=!0},e.focusLast=function(){e.editLastName=!0},e.focusUserName=function(){e.editUserName=!0},e.focusPassword=function(){e.editPassword=!0},e.focusStatus=function(){e.editStatus=!0},e.focusPLevel=function(){e.editPLevel=!0},e.hasSupervisor=function(){return user=e.cUser,user&&user.supervisorUserID?!0:!1},e.hasTimesheetApprover=function(){return user=e.cUser,user&&user.timesheetApproverUserID?!0:!1},e.save=function(){user=e.cUser,user.put().then(function(){t.path("users"),toastr.success("User Profile Updated")})}}]),cascadiaControllers.controller("WPDetailsController",["$scope","Restangular","$routeParams","GrowlResponse","calculateBudget","FilterUser",function(e,t,r,o,n,s){e.param=r.id,e.quantity=20,e.package={},e.listOfEffort=[];var a=function(){e.listOfEffort=[{pLevel:"P1",personDays:0},{pLevel:"P2",personDays:0},{pLevel:"P3",personDays:0},{pLevel:"P4",personDays:0},{pLevel:"P5",personDays:0},{pLevel:"DS",personDays:0},{pLevel:"SS",personDays:0}]},c=t.one("work_packages/"+e.param);c.get().then(function(t){e.package=t,i(),u(),e.package.estimateAtStart&&e.package.estimateAtStart.length>0?(e.listOfEffort=e.package.estimateAtStart,e.hasEffort=!0):(a(),e.hasEffort=!1)}),c.getList("assignments").then(function(t){e.assignedUsers=t}),c.getList("status_reports").then(function(t){e.reports=t});var i=function(){t.one("projects/"+e.package.projectNumber).get().then(function(t){e.project=t})},u=function(){t.one("reports/work_package/budget/"+e.package.workPackageNumber).get().then(function(t){e.report=t;var r=e.report.InitialEstimate,o=e.report.RemainingEstimate,s=e.report.CurrentSpending;e.dataArray=n(r,o,s)})};e.search=function(t){return s(t,e.query)},e.save=function(){e.package.estimateAtStart=e.listOfEffort,e.package.put()},e.openReport=function(t){$location.path("wp-status-report/"+e.package.workPackageNumber+"/"+t.id)}}]),cascadiaControllers.controller("WPStatusReportClosedController",["$scope","$location","$routeParams","Restangular","GrowlResponse",function(e,t,r,o){var n=r.wpid,s=r.id;e.wp={},o.one("work_packages/"+n+"/status_reports/"+s).get().then(function(t){e.report=t})}]),cascadiaControllers.controller("WPStatusReportController",["$scope","$location","$routeParams","Restangular","GrowlResponse",function(e,t,r,o,n){var s=r.id;e.package={},e.problemEncountered,e.problemAnticipated,e.workPlanned,e.comment,e.workAccomplished,o.one("work_packages",s).get().then(function(t){e.package=t}),e.listOfEffort=[{pLevel:"P1",personDays:0},{pLevel:"P2",personDays:0},{pLevel:"P3",personDays:0},{pLevel:"P4",personDays:0},{pLevel:"P5",personDays:0},{pLevel:"DS",personDays:0},{pLevel:"SS",personDays:0}],e.submit=function(){var r={reportDate:e.reportDate,workPackageNumber:e.package.workPackageNumber,comment:e.comment,workAccomplished:e.workAccomplished,problemEncountered:e.problemEncountered,problemAnticipated:e.problemAnticipated,workPlanned:e.workPlanned,estimatedWorkRemainingInPD:e.listOfEffort};o.one("work_packages/"+e.package.workPackageNumber+"/status_reports").customPOST(r).then(function(r){t.path("wp-details/"+e.package.workPackageNumber),n(r)},function(e){n(e)})}}]),cascadiaControllers.controller("CreateUserController",["$scope","$rootScope","Restangular","GrowlResponse","$location",function(e,t,r,o,n){e.items=["P1","P2","P3","P4","P5"],e.statuses=["Active","Inactive"],e.cUser={},e.save=function(){e.createUserForm.$valid?(user=e.cUser,r.one("users").customPOST(user).then(function(){n.path("/users"),toastr.success("User Created")},function(e){o(e)})):toastr.warning("Invalid or Incomplete Input")}}]),cascadiaControllers.controller("UsersManagementController",["$scope","$location","$rootScope","Restangular","FilterUser","GrowlResponse",function(e,t,r,o,n,s){var a=o.all("users");e.items=["P1","P2","P3","P4","P5","DS","SS"],e.statuses=["Active","Inactive"],e.quantity=20,e.cUser={};var c=function(){o.one("user").get().then(function(t){e.cUser=t})};a.getList().then(function(t){c(),e.users=t},function(e){s(e)}),e.hasSupervisor=function(e){return e&&e.supervisorUserID?!0:!1},e.select=function(e){t.path("/users/"+e.id)},e.search=function(t){return n(t,e.query)},e.delete=function(t,r){t.remove().then(function(){e.users.splice(r,1)}),console.log("user deleted")},e.add=function(){e.add_user=!0}}]);