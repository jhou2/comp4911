var cascadiaControllers=angular.module("cascadiaControllers",["base64","restangular"]);cascadiaControllers.service("CascadiaService",function(e){e.user=JSON.parse(localStorage.getItem("user")),this.initMapOfUsers=function(a){var t=new Worker("js/web-worker.js");t.addEventListener("message",function(a){e.mapOfUsers=JSON.parse(a.data)},!1),t.postMessage(JSON.stringify(a))}}),cascadiaControllers.controller("EngineerController",["$scope",function(e){function a(a){a.selected===!0&&a.disabled!==!0&&(e.selectedEngineers.push({number:a.number,name:a.name,paygrade:a.paygrade,selected:!1}),a.disabled=!0,a.selected=!1)}function t(a){if(void 0!==a&&a.selected===!0){for(var t=a.number,n=0;n<e.engineers.length;n++)e.engineers[n].number==t&&(e.engineers[n].disabled=!1);var r=e.selectedEngineers.indexOf(a);return r>-1&&e.selectedEngineers.splice(r,1),!0}return!1}e.engineers=[{number:"A1111",name:"Javier Olson",paygrade:"P4",selected:!1,disabled:!1},{number:"A1112",name:"Nancy Garcia",paygrade:"P5",selected:!1,disabled:!1},{number:"A1113",name:"David Bowden",paygrade:"SS",selected:!1,disabled:!1}],e.selectedEngineers=[],e.selectE=function(a){e.engineers[a].disabled||(e.engineers[a].selected=e.engineers[a].selected?!1:!0)},e.addedSelectE=function(a){e.selectedEngineers[a].selected=e.selectedEngineers[a].selected?!1:!0},e.addE=function(){e.engineers.forEach(a)},e.removeE=function(){for(var a=e.selectedEngineers.length,n=0;a>n;)t(e.selectedEngineers[n])||n++}}]),cascadiaControllers.controller("AEPController",["$scope","CascadiaService","$location","Restangular",function(e,a,t,n){n.all("projects").getList().then(function(a){e.projects=a})}]),cascadiaControllers.controller("AEWPController",["$scope","CascadiaService","$location","Restangular","$routeParams",function(e,a,t,n,r){e.param=r.id,n.all("work_packages/"+e.param).getList().then(function(a){e.packages=a})}]),cascadiaControllers.controller("ManagerController",["$scope",function(e){function a(e){e.selected=!1}e.managers=[{id:"A1111",name:"Javier Olson",paygrade:"P4",selected:!1},{id:"A1112",name:"Nancy Garcia",paygrade:"P2",selected:!1},{id:"A1113",name:"David Bowden",paygrade:"P5",selected:!1},{id:"A1114",name:"Juan Burdine",paygrade:"SS",selected:!1}],e.selectedManager={},e.selectM=function(t){e.managers[t].id;e.managers.forEach(a),e.managers[t].selected=!0,e.selectedManager=e.managers[t]},e.cancel=function(){e.selectedManager={},e.managers.forEach(a)}}]),cascadiaControllers.controller("APController",["$scope","CascadiaService","$location","Restangular",function(e,a,t,n){n.all("projects").getList().then(function(a){e.projects=a})}]),cascadiaControllers.controller("ARController",["$scope","CascadiaService","$location","Restangular","$routeParams",function(e,a,t,n,r){e.param=r.id,n.one("work_packages/"+e.param).get().then(function(a){e.package=a}),n.all("users").getList().then(function(a){e.engineers=a})}]),cascadiaControllers.controller("ASController",["$scope","CascadiaService","$location","Restangular",function(e,a,t,n){n.all("users").getList().then(function(a){e.projects=a})}]),cascadiaControllers.controller("PackageController",["$scope",function(e){function a(a){a.selected===!0&&a.disabled!==!0&&(e.selectedPackages.push({number:a.number,title:a.title,selected:!1}),a.disabled=!0,a.selected=!1)}function t(a){if(void 0!==a&&a.selected===!0){for(var t=a.number,n=0;n<e.packages.length;n++)e.packages[n].number==t&&(e.packages[n].disabled=!1);var r=e.selectedPackages.indexOf(a);return r>-1&&e.selectedPackages.splice(r,1),!0}return!1}e.packages=[{number:"B1111",title:"Project Setup",selected:!1,disabled:!1},{number:"B1112",title:"Ongoing Updating",selected:!1,disabled:!1},{number:"B1113",title:"Detailed Planning",selected:!1,disabled:!1}],e.selectedPackages=[],e.select=function(a){e.packages[a].disabled||(e.packages[a].selected=e.packages[a].selected?!1:!0)},e.addedSelect=function(a){e.selectedPackages[a].selected=e.selectedPackages[a].selected?!1:!0},e.add=function(){e.packages.forEach(a)},e.remove=function(){for(var a=e.selectedPackages.length,n=0;a>n;)t(e.selectedPackages[n])||n++}}]),cascadiaControllers.controller("CreateProjectsController",["$scope","CascadiaService","$location","Restangular",function(){}]),cascadiaControllers.controller("DashboardController",["$scope","$rootScope","Restangular","CascadiaService",function(e,a,t){t.one("user/timesheets").get().then(function(a){e.timesheets=a}),e.date=function(a){var t=e.timesheets[a],n=1+7*(t.weekNumber-1);return new Date(t.year,0,n)},e.delete=function(a,t){user.remove().then(function(){e.timesheets.splice(t,1)}),console.log("timesheet deleted")}}]),cascadiaControllers.controller("EditPayRatesController",["$scope","CascadiaService","$location","Restangular",function(e,a,t,n){var r=n.all("pay_rates");r.getList().then(function(a){e.payRates=a}),payRatesChanged=[],e.change=function(e){unique=!0;for(var a=0;a<payRatesChanged.length;a++)if(payRatesChanged[a].id==e.id){unique=!1;break}unique&&payRatesChanged.push(e)},e.edit=function(){for(var e=0;e<payRatesChanged.length;e++)payRatesChanged[e].put()}}]),cascadiaControllers.controller("EngineerBudgetController",["$scope","CascadiaService","$location","Restangular",function(){}]),cascadiaControllers.controller("IndexController",["$scope","CascadiaService","$location",function(e,a,t){e.logout=function(){localStorage.clear(),t.path("/login"),$.growl.notice({title:"Success!",message:"You have been logged out."})}}]),cascadiaControllers.controller("LoginController",["$scope","$base64","Restangular","$rootScope","$location","CascadiaService",function(e,a,t,n,r){e.login=function(){var o={username:e.username,password:e.password};t.one("user").post("token",o).then(function(o){e.encodedString=a.encode(o.token+":"),localStorage.setItem("token",e.encodedString),t.setDefaultHeaders({Authorization:"Basic "+e.encodedString}),t.one("user").get().then(function(e){localStorage.setItem("user",JSON.stringify(e)),n.user=e,r.path("/dashboard")})},function(e){400==e.status?$.growl.error({title:"Error!",message:"Missing username or password."}):401==e.status?$.growl.error({title:"Error!",message:"Authentication failed, please check your credentials again."}):$.growl.error({title:"Error!",message:"Status Code "+e.status})})}}]),cascadiaControllers.controller("LogoutController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("ManageApproverController",["$scope","CascadiaService","$location","Restangular",function(){}]),cascadiaControllers.controller("ManageProjectController",["$scope","CascadiaService","$location","Restangular",function(){}]),cascadiaControllers.controller("WPManagementController",["$scope","CascadiaService","$location","Restangular",function(e,a,t,n){e.statuses=["Open","Closed"],e.project={},mapOfWP={},wpChanged=[],e.listWP=function(a){n.one("work_packages/project").getList(a.projectNumber).then(function(a){e.workPackages=a})},n.one("user/projects/managed").getList().then(function(a){e.projects=a}),e.change=function(e){unique=!0;for(var a=0;a<wpChanged.length;a++)if(wpChanged[a].workPackageNumber==e.workPackageNumber){unique=!1;break}unique&&wpChanged.push(e)},e.edit=function(){for(var e=0;e<wpChanged.length;e++)el=wpChanged[e],n.one("work_packages",el.workPackageNumber).customPUT(el);wpChanged=[]}}]),cascadiaControllers.controller("MonthlyWPController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCBACController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCPRController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("ProjectManagementController",["$scope","CascadiaService","Restangular",function(e,a,t){var n=t.all("projects");t.one("user/projects/managed").getList().then(function(a){e.projects=a}),e.add=function(){e.add_project=!0},e.save=function(){newproject=e.newproject,n.post(newproject).then(function(){e.projects.push(newproject),e.add_project=!1})}}]),cascadiaControllers.controller("ProjectSummaryController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("RateSheetController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("SearchProjectController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("TimesheetController",["$scope","$rootScope","CascadiaService","$location","Restangular",function(e,a,t,n,r){var o=r.one("user/timesheets");e.workPackageNumbers={},e.projectNumbers=[],r.one("user/projects/managed").getList().then(function(a){projects=a;for(var t=0;t<projects.length;++t)e.projectNumbers.push(projects[t].projectNumber)}),e.listWP=function(a){r.one("work_packages/project",a).getList().then(function(t){workPackages=t,e.workPackageNumbers[a]=[];for(var n=0;n<workPackages.length;++n)e.workPackageNumbers[a].push(workPackages[n].workPackageNumber)})},e.prior=function(){year=e.timesheet.year,week=e.timesheet.weekNumber-1,o.get({year:year,week:week}).then(function(a){e.timesheet=a})},e.next=function(){year=e.timesheet.year,week=e.timesheet.weekNumber+1,o.get({year:year,week:week}).then(function(a){e.timesheet=a})},o.get({filter:"current"}).then(function(a){currentTimesheet=a,e.timesheet=currentTimesheet}),e.save=function(){e.default&&a.user.defaultTimesheetID!=e.timesheet.id&&(a.user.defaultTimesheetID=e.timesheet.id,a.user.put()),e.timesheet.put()},e.delete=function(a){e.timesheet.timesheetRows.splice(a,1)},e.add=function(){e.timesheet.timesheetRows.push({workPackageNumber:"",projectNumber:"",saturday:0,sunday:0,monday:0,tuesday:0,wednesday:0,thursday:0,friday:0,total:0,note:""})}}]),cascadiaControllers.controller("UserProfileController",["$scope","CascadiaService","$routeParams","Restangular",function(e,a,t,n){e.param=t.id;var r=n.one("users"+t.id);r.get().then(function(a){e.user=a})}]),cascadiaControllers.controller("WeeklyProjectController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("WPDetailsController",["$scope","Restangular","$routeParams",function(e,a,t){e.param=t.id;var n=a.one("work_packages/"+e.param);n.get().then(function(a){e.package=a})}]),cascadiaControllers.controller("WPStatusReportController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("UsersManagementController",["$scope","$rootScope","Restangular","CascadiaService",function(e,a,t,n){var r=t.all("users");e.items=["P1","P2","P3","P4","P5"],e.statuses=["Active","Inactive"],usersChanged=[],r.getList().then(function(a){e.users=a,n.initMapOfUsers(e.users)}),e.change=function(e){unique=!0;for(var a=0;a<usersChanged.length;a++)if(usersChanged[a].id==e.id){unique=!1;break}unique&&usersChanged.push(e)},e.delete=function(a,t){a.remove().then(function(){e.users.splice(t,1)}),console.log("user deleted")},e.edit=function(){for(var e=0;e<usersChanged.length;e++)usersChanged[e].put();usersChanged=[]},e.add=function(){e.add_user=!0},e.save=function(){newuser=e.newuser,r.post(newuser).then(function(){e.add_user=!1})}}]);