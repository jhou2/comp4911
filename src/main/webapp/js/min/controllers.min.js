var cascadiaControllers=angular.module("cascadiaControllers",["base64"]);cascadiaControllers.controller("EngineerController",["$scope","GrowlResponse",function(e){function t(t){t.selected===!0&&t.disabled!==!0&&(e.selectedEngineers.push({number:t.number,name:t.name,paygrade:t.paygrade,selected:!1}),t.disabled=!0,t.selected=!1)}function r(t){if(void 0!==t&&t.selected===!0){for(var r=t.number,o=0;o<e.engineers.length;o++)e.engineers[o].number==r&&(e.engineers[o].disabled=!1);var n=e.selectedEngineers.indexOf(t);return n>-1&&e.selectedEngineers.splice(n,1),!0}return!1}e.engineers=[{number:"A1111",name:"Javier Olson",paygrade:"P4",selected:!1,disabled:!1},{number:"A1112",name:"Nancy Garcia",paygrade:"P5",selected:!1,disabled:!1},{number:"A1113",name:"David Bowden",paygrade:"SS",selected:!1,disabled:!1}],e.selectedEngineers=[],e.selectE=function(t){e.engineers[t].disabled||(e.engineers[t].selected=e.engineers[t].selected?!1:!0)},e.addedSelectE=function(t){e.selectedEngineers[t].selected=e.selectedEngineers[t].selected?!1:!0},e.addE=function(){e.engineers.forEach(t)},e.removeE=function(){for(var t=e.selectedEngineers.length,o=0;t>o;)r(e.selectedEngineers[o])||o++}}]),cascadiaControllers.controller("AEPController",["$rootScope","$scope","$location","$routeParams","Restangular","GrowlResponse",function(e,t,r,o,n){function s(e){if(e.selected===!0&&e.disabled!==!0){t.selectedProjects.push({projectNumber:e.projectNumber,projectName:e.projectName,selected:!1}),e.disabled=!0,e.selected=!1;var r={userId:t.cUser.id,projectNumber:e.projectNumber,active:!0};n.one("projects/"+e.projectNumber+"/assignments").customPOST(r).then(function(){$.growl.notice("Success","Object Created")})}}function a(e){if(void 0!==e&&e.selected===!0){for(var r=e.projectNumber,o=0;o<t.projects.length;o++)t.projects[o].projectNumber==r&&(t.projects[o].disabled=!1);var n=t.selectedProjects.indexOf(e);return n>-1&&t.selectedProjects.splice(n,1),!0}return!1}var c=o.id;t.cUser=e.userMap[c],t.selectedProjects=[],n.all("users/"+t.cUser.id+"/projects").getList().then(function(e){t.selectedProjects=e}),n.all("projects").getList().then(function(e){t.projects=e}),t.selectP=function(e){t.projects[e].disabled||(t.projects[e].selected=t.projects[e].selected?!1:!0)},t.addedSelectP=function(e){t.selectedProjects[e].selected=t.selectedProjects[e].selected?!1:!0},t.addP=function(){t.projects.forEach(s)},t.removeP=function(){for(var e=t.selectedProjects.length,r=0;e>r;)a(t.selectedProjects[r])||r++}}]),cascadiaControllers.controller("AEWPController",["$scope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o){e.param=o.id,r.all("work_packages/"+e.param).getList().then(function(t){e.packages=t})}]),cascadiaControllers.controller("ManagerController",["$scope","$routeParams","GrowlResponse",function(e,t){function r(e){e.selected=!1}var o=t.id;e.project={},Restangular.one("projects",o).get().then(function(t){e.project=t}),e.selectedManager={},e.selectM=function(t){e.managers[t].id;e.managers.forEach(r),e.managers[t].selected=!0,e.selectedManager=e.managers[t]},e.cancel=function(){e.selectedManager={},e.managers.forEach(r)}}]),cascadiaControllers.controller("APController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){r.one("users",3).get().then(function(t){e.manUser=t}),r.all("projects").getList().then(function(t){e.projects=t})}]),cascadiaControllers.controller("ARController",["$scope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o){e.param=o.id,r.one("work_packages/"+e.param).get().then(function(t){e.package=t}),r.all("users").getList().then(function(t){e.engineers=t})}]),cascadiaControllers.controller("ASController",["$scope","$rootScope","$routeParams","$location","Restangular","GrowlResponse",function(e,t,r,o,n){var s=r.id;e.cUser=t.userMap[s],e.select=function(t){e.selectedEngineer=t},e.search=function(t){return-1!=t.id.toString().indexOf(e.query)||-1!=t.firstName.indexOf(e.query)||-1!=t.lastName.indexOf(e.query)?!0:!1},e.save=function(){var r=t.userMap[e.cUser.id];r.supervisorUserID=e.selectedEngineer.id,n.one("users",r.id).customPUT(r).then(function(){o.path("users/"+r.id)})}}]),cascadiaControllers.controller("PackageController",["$scope","GrowlResponse",function(e){function t(t){t.selected===!0&&t.disabled!==!0&&(e.selectedPackages.push({number:t.number,title:t.title,selected:!1}),t.disabled=!0,t.selected=!1)}function r(t){if(void 0!==t&&t.selected===!0){for(var r=t.number,o=0;o<e.packages.length;o++)e.packages[o].number==r&&(e.packages[o].disabled=!1);var n=e.selectedPackages.indexOf(t);return n>-1&&e.selectedPackages.splice(n,1),!0}return!1}e.packages=[{number:"B1111",title:"Project Setup",selected:!1,disabled:!1},{number:"B1112",title:"Ongoing Updating",selected:!1,disabled:!1},{number:"B1113",title:"Detailed Planning",selected:!1,disabled:!1}],e.selectedPackages=[],e.select=function(t){e.packages[t].disabled||(e.packages[t].selected=e.packages[t].selected?!1:!0)},e.addedSelect=function(t){e.selectedPackages[t].selected=e.selectedPackages[t].selected?!1:!0},e.add=function(){e.packages.forEach(t)},e.remove=function(){for(var t=e.selectedPackages.length,o=0;t>o;)r(e.selectedPackages[o])||o++}}]),cascadiaControllers.controller("CreateProjectsController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r,o){var n=r.all("projects");e.rates=[1.2,1.6,2],e.save=function(){n.post(e.project).then(function(){$.growl.notice("Success","Object Created")},function(e){o(e)})}}]),cascadiaControllers.controller("CreateWPController",["$scope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o,n){var s=o.id;e.workPackage={},e.project={},e.loadCurrentProject=function(){r.all("projects").getList().then(function(t){e.projects=t}),r.one("projects",s).get().then(function(t){e.project=t})},e.statuses=["Open","Closed"],e.save=function(){workPackage=e.workPackage,workPackage.projectNumber=e.project.projectNumber,r.one("work_packages").customPOST(workPackage).then(function(){$.growl.notice("Success","Object Created")},function(e){n(e)})}}]),cascadiaControllers.controller("DashboardController",["$scope","$rootScope","Restangular","GrowlResponse",function(e,t,r){r.all("user/timesheets").getList().then(function(t){e.timesheets=t}),e.date=function(t){var r=e.timesheets[t],o=1+7*(r.weekNumber-1);return new Date(r.year,0,o)},e.delete=function(t,r){user.remove().then(function(){e.timesheets.splice(r,1)}),console.log("timesheet deleted")}}]),cascadiaControllers.controller("EditPayRatesController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){var o=r.all("pay_rates");e.payRatesMap={},e.payRates=[],o.getList().then(function(t){e.payRates=t;for(var r=0;r<e.payRates.length;++r)e.payRatesMap[e.payRates[r].year]=[];for(var r=0;r<e.payRates.length;++r)e.payRatesMap[e.payRates[r].year].push(e.payRates[r])}),e.index=2014,payRatesChanged=[],e.change=function(e){unique=!0;for(var t=0;t<payRatesChanged.length;t++)if(payRatesChanged[t].id==e.id){unique=!1;break}unique&&payRatesChanged.push(e)},e.edit=function(){for(var e=0;e<payRatesChanged.length;e++)payRatesChanged[e].put()},e.prior=function(){e.payRatesMap[e.index-2]&&e.index--},e.next=function(){e.payRatesMap[e.index+2]&&e.index++},e.current=function(){e.index=2014}}]),cascadiaControllers.controller("EngineerBudgetController",["$scope","$location","Restangular",function(){}]),cascadiaControllers.controller("NavigationController",["$scope","$rootScope","$location","Restangular","GrowlResponse",function(e,t,r,o){o.all("user");e.user=JSON.parse(localStorage.getItem("user")),e.logout=function(){localStorage.clear(),r.path("/login"),$.growl.notice({title:"Success!",message:"You have been logged out."})}}]),cascadiaControllers.controller("LoginController",["$scope","$base64","Restangular","$rootScope","$location","GrowlResponse","permissions",function(e,t,r,o,n,s,a){e.login=function(){var c={username:e.username,password:e.password};r.one("user").post("token",c).then(function(s){e.encodedString=t.encode(s.token+":"),localStorage.setItem("token",e.encodedString),r.setDefaultHeaders({Authorization:"Basic "+e.encodedString}),r.one("user").get().then(function(e){localStorage.setItem("user",JSON.stringify(e)),o.user=e,r.one("user/permissions").get().then(function(e){a.setPermissions(e),localStorage.setItem("permissions",JSON.stringify(e))},function(){var e=[{Name:"ProjectManager"},{Name:"Supervisor"},{Name:"Hr"},{Name:"TimesheetApprover"}];localStorage.setItem("permissions",JSON.stringify(e)),a.setPermissions(e)}),n.path("/dashboard")})},function(e){s(e)})}}]),cascadiaControllers.controller("LogoutController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("ManageApproverController",["$scope","$location","Restangular",function(){}]),cascadiaControllers.controller("ManageProjectController",["$scope","$location","Restangular",function(){}]),cascadiaControllers.controller("WPManagementController",["$scope","Restangular","GrowlResponse",function(e,t){e.statuses=["Open","Closed"],e.project={},mapOfWP={},wpChanged=[],e.listWP=function(r){t.one("work_packages/project").getList(r.projectNumber).then(function(t){e.workPackages=t})},t.one("user/projects/managed").getList().then(function(t){e.projects=t}),e.change=function(e){unique=!0;for(var t=0;t<wpChanged.length;t++)if(wpChanged[t].workPackageNumber==e.workPackageNumber){unique=!1;break}unique&&wpChanged.push(e)},e.edit=function(){for(var e=0;e<wpChanged.length;e++)el=wpChanged[e],t.one("work_packages",el.workPackageNumber).customPUT(el);wpChanged=[]}}]),cascadiaControllers.controller("MonthlyWPController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCBACController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("PCPRController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("ProjectManagementController",["$scope","Restangular","GrowlResponse",function(e,t){var r=t.all("projects");t.one("user/projects/managed").getList().then(function(t){e.projects=t}),e.add=function(){e.add_project=!0},e.save=function(){newproject=e.newproject,r.post(newproject).then(function(){e.projects.push(newproject),e.add_project=!1})}}]),cascadiaControllers.controller("ProjectSummaryController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("RateSheetController",["$scope","Restangular","GrowlResponse",function(e,t){t.all("users").getList().then(function(t){e.users=t})}]),cascadiaControllers.controller("SearchProjectController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("TADetailsController",["$scope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o){e.param=o.id,r.one("timesheets",e.param).get().then(function(t){e.timesheet=t}),e.approve=function(){e.timesheet.approved=!0,e.timesheet.pending=!1,e.timesheet.put(),t.path("/timesheet-approval")},e.reject=function(){e.timeshet.pending=!1,e.timesheet.put(),t.path("/timesheet-approval")}}]),cascadiaControllers.controller("TAController",["$scope","$location","Restangular","GrowlResponse",function(e,t,r){e.timesheets=[],r.all("user/timesheets/to_approve").getList().then(function(t){e.timesheets=t}),e.select=function(r){var o=r,n="/timesheet/",s=n.concat(e.timesheets[o].id);t.path(s)}}]),cascadiaControllers.controller("TimesheetController",["$scope","$rootScope","$location","Restangular","$routeParams","GrowlResponse",function(e,t,r,o,n,s){var a=o.one("user/timesheets");e.workPackageNumbers={},e.projectNumbers=[],a.get({filter:"current"}).then(function(t){currentTimesheet=t,e.timesheet=currentTimesheet},function(e){s(e)}),o.one("user/projects/managed").getList().then(function(t){projects=t;for(var r=0;r<projects.length;++r)e.projectNumbers.push(projects[r].projectNumber)},function(e){s(e)}),e.listWP=function(t){o.one("work_packages/project",t).getList().then(function(r){workPackages=r,e.workPackageNumbers[t]=[];for(var o=0;o<workPackages.length;++o)e.workPackageNumbers[t].push(workPackages[o].workPackageNumber)},function(e){s(e)})},e.prior=function(){year=e.timesheet.year,week=e.timesheet.weekNumber-1,a.get({year:year,week:week}).then(function(t){e.timesheet=t},function(e){s(e)})},e.next=function(){year=e.timesheet.year,week=e.timesheet.weekNumber+1,a.get({year:year,week:week}).then(function(t){e.timesheet=t},function(e){s(e)})},e.save=function(){e.default&&t.user.defaultTimesheetID!=e.timesheet.id&&(t.user.defaultTimesheetID=e.timesheet.id,t.user.put()),e.timesheet.put()},e.submit=function(){e.timsheet.pending=!0},e.delete=function(t){e.timesheet.timesheetRows.splice(t,1)},e.add=function(){e.timesheet.timesheetRows.push({workPackageNumber:"",projectNumber:"",saturday:0,sunday:0,monday:0,tuesday:0,wednesday:0,thursday:0,friday:0,note:""})}}]),cascadiaControllers.controller("UserProfileController",["$scope","$rootScope","$routeParams","Restangular",function(e,t){t.user=JSON.parse(localStorage.getItem("user")),e.hasSupervisor=function(){var e=t.user;return e.supervisorUserID&&e.supervisorUserID!=e.id?!0:!1},e.hasTimesheetApprover=function(){return user=t.user,user.timesheetApproverUserID&&user.timesheetApproverUserID!=user.id?!0:!1}}]),cascadiaControllers.controller("ManagedUserProfileController",["$scope","$location","$rootScope","$routeParams","Restangular",function(e,t,r,o){var n=o.id;e.cUser=r.userMap[n],e.hasSupervisor=function(){return user=r.userMap[n],user.supervisorUserID&&user.supervisorUserID!=user.id?!0:!1},e.hasTimesheetApprover=function(){return user=r.userMap[n],user.timesheetApproverUserID&&user.timesheetApproverUserID!=user.id?!0:!1},e.assign=function(){t.path("/assign-supervisor/"+e.cUser.id)}}]),cascadiaControllers.controller("WeeklyProjectController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("WPDetailsController",["$scope","Restangular","$routeParams","GrowlResponse",function(e,t,r){e.param=r.id;var o=t.one("work_packages/"+e.param);o.get().then(function(t){e.package=t}),t.all("work_packages/"+e.param+"/assignments").getList().then(function(t){e.assignments=t})}]),cascadiaControllers.controller("WPStatusReportController",["$scope","Restangular",function(){}]),cascadiaControllers.controller("CreateUserController",["$scope","Restangular","GrowlResponse","$location",function(e,t,r){e.items=["P1","P2","P3","P4","P5"],e.statuses=["Active","Inactive"],e.cUser={},e.cUser.supervisorUserID=e.user.id,e.save=function(){user=e.cUser,t.one("users").customPOST(user).then(function(){$.growl.notice("Success","Object Created")},function(e){r(e)})}}]),cascadiaControllers.controller("UsersManagementController",["$scope","$location","$rootScope","Restangular","GrowlResponse",function(e,t,r,o,n){var s=o.all("users");e.items=["P1","P2","P3","P4","P5"],e.statuses=["Active","Inactive"],e.cUser={},usersChanged=[],s.getList().then(function(t){e.users=t},function(e){GrowlRespone(e)}),e.hasSupervisor=function(e){return e.supervisorUserID&&e.supervisorUserID!=e.id?!1:!0},e.select=function(e){t.path("/users/"+e.id)},e.change=function(e){unique=!0;for(var t=0;t<usersChanged.length;t++)if(usersChanged[t].id==e.id){unique=!1;break}unique&&usersChanged.push(e)},e.delete=function(t,r){t.remove().then(function(){e.users.splice(r,1)}),console.log("user deleted")},e.edit=function(){for(var e=0;e<usersChanged.length;e++)usersChanged[e].put();usersChanged=[]},e.add=function(){e.add_user=!0},e.save=function(){newuser=e.newuser,s.post(newuser).then(function(){e.add_user=!1},function(e){n(e)})}}]);